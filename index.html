<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>現在是搶龍時間</title>
    <style>
        body {
            background-color: #282c35;
            color: #ffffff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            text-align: center;
            margin: 0;
            padding: 20px;
        }

        #currentTime {
            font-size: 3em;
            margin-bottom: 20px;
        }

        #timezone {
            font-size: 1.2em;
            margin-bottom: 20px;
        }

        #timezoneSelect {
            font-size: 1.5em;
            padding: 10px;
            border: none;
            background-color: #40444f;
            color: white;
            cursor: pointer;
            border-radius: 5px;
        }

        #countdown {
            font-size: 2em;
            margin-top: 10px;
        }

        #dragonText {
            margin-top: 10px;
            font-size: 2em;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.5s ease-in-out, font-size 0.5s linear, background-color 0.5s ease-in-out;
            background-color: transparent; /* Initial background color */
        }

        .flashing {
            animation: flash 1s infinite alternate;
        }

        @keyframes flash {
            from {
                background-color: transparent;
            }
            to {
                background-color: red;
            }
        }

        #elderText {
            margin-top: 10px;
            font-size: 2em;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.5s ease-in-out, font-size 0.5s linear;
        }

        #footer {
            position: fixed;
            bottom: 0;
            width: 100%;
            background-color: #40444f;
            color: white;
            padding: 10px;
            margin-left: -20px;
        }

        label {
            font-size: 1.5em;
            margin-bottom: 10px;
            display: block;
        }

        /* 添加媒體查詢，根據設備的寬度應用不同的樣式 */
        @media only screen and (max-width: 600px) {
            #currentTime {
                font-size: 2em;
            }

            #timezone {
                font-size: 1em;
            }

            #timezoneSelect {
                font-size: 1.5em;
            }

            #countdown {
                font-size: 1.5em;
            }

            #dragonText {
                font-size: 1.2em; /* 修改字體大小 */
            }

            #elderText {
                font-size: 1.2em; /* 修改字體大小 */
            }

            #footer {
                padding: 8px;
            }

            label {
                font-size: 1.2em;
            }
        }
    </style>
</head>
<body>
    <div id="timezone"></div>
    <div id="currentTime"></div>

    <label for="timezoneSelect">選擇時區：</label>
    <select id="timezoneSelect" onchange="updateTimezone(this.value)">
        <option value="America/Los_Angeles" data-offset="-8">美國西部時間 (UTC-8)</option>
        <option value="America/Chicago" data-offset="-6">美國中部時間 (UTC-6)</option>
        <option value="America/New_York" data-offset="-5">美國東部時間 (UTC-5)</option>
        <option value="Europe/London" data-offset="0">英國時間 (UTC+0)</option>
        <option value="Asia/Taipei" selected data-offset="8">台北標準時間 (UTC+8)</option>
        <option value="Asia/Tokyo" data-offset="9">日本標準時間 (UTC+9)</option>
    </select>

    <div id="countdown"></div>
    <div id="dragonText"></div>
    <div id="elderText"></div>

    <div id="footer"><span>&copy;搶龍時鐘 ver 0.0.3 更新於: 2023/12/1 </span></div>

    <script>
        let selectedTimezone = "Asia/Taipei";

        function updateTime() {
            const now = new Date();
			now.setMilliseconds(now.getMilliseconds() - 500);
            const options = { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit', timeZone: selectedTimezone };
            const timeString = now.toLocaleTimeString('en-US', options);

            const isMorningFiveUTC = now.getUTCHours() === 5;
            const isMorningElevenUTC = now.getUTCHours() === 11;
            const isAfternoonFiveUTC = now.getUTCHours() === 17;
            const isEveningElevenUTC = now.getUTCHours() === 23;


            const offset = parseInt(document.getElementById('timezoneSelect').selectedOptions[0].getAttribute('data-offset'));
            const timezoneOffsetString = offset >= 0 ? `+${offset}` : offset;

            document.getElementById('timezone').innerHTML = `時區：${selectedTimezone} (UTC${timezoneOffsetString})`;
            document.getElementById('currentTime').innerHTML = `現在時間：${timeString}`;

            // 計算距離下一個時刻的倒計時
            const minutes = now.getMinutes();
            const seconds = now.getSeconds();
            let countdownSeconds;

	    if ((isMorningFiveUTC || isMorningElevenUTC || isAfternoonFiveUTC || isEveningElevenUTC) && minutes < 15) {

            document.getElementById('elderText').innerHTML = '窮老頭來了，快去抽獎，祝好運!!!';
            document.getElementById('elderText').style.opacity = 1;

            } else {

            document.getElementById('elderText').style.opacity = 0;

            }


         
            if (minutes % 3 === 2 && seconds >= 50) {
                countdownSeconds = 60 - seconds;
                document.getElementById('dragonText').innerHTML = '快點抓龍!!!!!';				
				document.getElementById('dragonText').classList.add('flashing'); // Add flashing effect
                document.getElementById('dragonText').style.opacity = 1;
				
                // 計算動態字體大小
                const fontSize = `${70 - countdownSeconds * 5}px`;;
                document.getElementById('dragonText').style.fontSize = fontSize;
            } else {
                const nextDragonMinute = (Math.floor(minutes / 3) + 1) * 3;
                countdownSeconds = (nextDragonMinute - minutes) * 60 - seconds;
                document.getElementById('dragonText').style.opacity = 0;
                document.getElementById('dragonText').style.fontSize = '2em'; // 非倒數時的字體大小

            }

            const countdownMinutes = Math.floor(countdownSeconds / 60);
            const countdownSecondsDisplay = countdownSeconds % 60;
            const countdownString = `${countdownMinutes}:${countdownSecondsDisplay < 10 ? '0' : ''}${countdownSecondsDisplay}`;
            document.getElementById('countdown').innerHTML = `距離下一個搶龍時間還有：${countdownString}`;
        }

        function updateTimezone(newTimezone) {
            selectedTimezone = newTimezone;
            updateTime();
        }

        // 根據 option 的 data-offset 屬性排序時區
        const select = document.getElementById('timezoneSelect');
        Array.from(select.options)
            .sort((a, b) => parseInt(a.getAttribute('data-offset')) - parseInt(b.getAttribute('data-offset')))
            .forEach(option => select.add(option));

        setInterval(updateTime, 10);
        updateTime();
    </script>
</body>
</html>